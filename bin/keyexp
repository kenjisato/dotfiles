#!/usr/bin/env osascript

on getExt(theFileName)
  do shell script "file=" & theFileName & ";" & "echo ${file##*.}"
end getExt

on run argv
	set keynote_path to (item 1 of argv)
	set out_path to (item 2 of argv)
  set extension to getExt(out_path)

	tell application "Keynote"
		set keynote_file to open (keynote_path as POSIX file)
		if extension is equal to "pdf" then
			export keynote_file to (out_path as POSIX file) as PDF
		else if extension is equal to "jpeg" then
			export keynote_file to (out_path as POSIX file) as slide images with properties { compression factor: 1.0, image format: JPEG }
		else
			do shell script "echo Output format " & extension & " not supported."
		end
		close keynote_file saving no
	end tell
end run
